InfoSec Log Monitoring System
=============================

Проект для тестирования систем безопасности с помощью симуляции логов обычной активности и атак.  
Состоит из сервера, нескольких клиентов-генераторов логов и админской консоли для мониторинга угроз в реальном времени. Поддерживает корреляцию событий, анализ и фильтрацию по пользователям, IP, уровням логов и компонентам системы.

---

Требования
----------
- Python 3.10+
- Node.js и npm (для генератора логов)
- Docker & Docker Compose
- SQLite3 (используется внутри контейнера)
- Python-пакеты: Flask, requests, PyJWT

---

Настройка и запуск проекта
--------------------------
1. Сборка Docker-контейнеров:
   docker-compose build

> Убедись, что предыдущие контейнеры остановлены, чтобы избежать конфликтов IP:
   docker-compose down --remove-orphans

2. Запуск проекта:
   docker-compose up

- server — Flask сервер на 0.0.0.0:8000  
- client1, client2, client3 — генераторы логов с разными MAC/IP  

> Каждый клиент автоматически генерирует логи и отправляет их на сервер каждые 1–2 секунды.  
> Логи с угрозами (THREAT) генерируются реже, чтобы имитировать реальные атаки.

3. Доступ внутрь контейнера:
   docker exec -it <container_name> /bin/bash

> Можно проверить наличие файлов, папку /app/logs и запустить клиент вручную для диагностики.

---

Админская CLI-консоль
--------------------
Подключение к контейнеру сервера:
docker exec -it server python /server/admin/cli.py

Основные команды:
help                - Показать справку
stats               - Показать количество всех логов, угроз и клиентов
threats [N]         - Показать последние N угроз (по умолчанию 10)
logs [user <name>]  - Показать последние логи, фильтровать по пользователю
logs [ip <ip>]      - Показать логи с определённого IP
logs [level <INFO|WARN|THREAT>] - Показать логи по уровню
attack-types        - Показать список всех типов атак
clients             - Список всех клиентов (MAC + ID)
watch               - Включить слежку за новыми угрозами в реальном времени
stop                - Остановить слежку
correlate           - Показать потенциально связанные события (по correlationId)
exit                - Выйти из CLI

> Команда correlate позволяет отследить цепочки связанных событий между разными компонентами или клиентами.

---

Конфигурация
------------
Сервер (server/config.py):
- JWT_SECRET — секрет для создания JWT
- JWT_ALGORITHM — алгоритм JWT
- JWT_EXP_SECONDS — время жизни токена
- AUTHORIZED_MACS — список разрешённых MAC-адресов клиентов
- AUTHORIZED_IPS — список разрешённых IP клиентов
- DB_PATH — путь к базе данных SQLite3 (db.sqlite3)

Клиент (client/config.py):
- CLIENT_ID — уникальный идентификатор клиента
- MAC_ADDRESS — MAC-адрес клиента
- CLIENT_IP — IP клиента (для фильтрации на сервере)
- SERVER_URL — адрес сервера
- LOG_DIR — папка с локальными логами
- LOG_ENDPOINT — API сервера для логов
- SEND_INTERVAL — интервал отправки логов на сервер
- USERNAMES — список пользователей для генерации логов

> В docker-compose.yml можно задать IP клиентов и сервера, чтобы включить фильтрацию по IP.

---

Генерация логов
---------------
- Логи генерируются клиентом автоматически через npm-проект log-generator.  
- Содержат как обычные действия пользователей, так и атаки.  
- Каждая строка содержит: timestamp, client_id, IP, уровень, описание события, correlationId.  
- Логи с угрозами (THREAT) генерируются реже для реалистичности.  
- Логи можно выводить в syslog для интеграции с Wazuh или другими SIEM.

---

База данных
-----------
- db.sqlite3 (SQLite3)
- Таблицы:
  - logs — все логи
  - threats — только обнаруженные угрозы
- Каждая запись содержит:
  - timestamp
  - client_id
  - mac
  - ip
  - level (INFO, WARNING, THREAT)
  - message
- Используется параметризация запросов, защищающая от SQL-инъекций.

---

Docker-сеть
------------
- Сервер и клиенты работают в отдельной внутренней сети Docker.
- Разрешены только IP и MAC, указанные в конфигурации.
- Можно протестировать с разными MAC и IP для каждого клиента.
- Логи можно писать в файл /app/logs/syslog.log для анализа снаружи.

---

Новые возможности и рекомендации
--------------------------------
1. Корреляция событий — возможность отслеживать связанные действия через correlationId.  
2. Реальный сценарий SIEM — редкие THREAT события, нормальная активность в 70–80% случаев.  
3. Фильтрация по IP, уровню, пользователю, компоненту.  
4. История и ротация логов — хранение до 30 дней, ротация файлов.  
5. Потоковая аналитика — батчи логов обрабатываются каждые 2 секунды.  
6. Защита от SQL-инъекций — все записи параметризованы через ?.  
7. CLI расширен — просмотр последних угроз, корреляция событий, фильтры по разным критериям.
