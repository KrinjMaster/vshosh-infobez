FROM python:3.11-slim

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: git + nodejs + npm
RUN apt-get update && apt-get install -y \
    git \
    nodejs \
    npm \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –ª–æ–≥–æ–≤
# üî¥ –ó–ê–ú–ï–ù–ò URL –ù–ê –°–í–û–ô –†–ï–ü–û–ó–ò–¢–û–†–ò–ô
RUN git clone https://github.com/summved/log-generator.git /app/log-generator

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º npm-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
WORKDIR /app/log-generator
RUN npm install

# –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–ª–∏–µ–Ω—Ç–∞
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥
COPY . .

# –ß—Ç–æ–±—ã Python –≤–∏–¥–µ–ª –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
ENV PYTHONPATH="/app:/app/log-generator"

CMD ["python3","-u", "main.py"]
